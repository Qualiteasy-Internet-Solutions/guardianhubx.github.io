<!doctype html><html lang=es><head><meta charset=utf-8><title>¬°Felicidades por tu puntuaci√≥n!</title>
<meta name=viewport content="width=device-width,initial-scale=1"><link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel=stylesheet><link id=arcade-css rel=stylesheet href=/css/arcade.css><link id=main-css rel=stylesheet href=/css/style.css disabled><link id=phishing-css rel=stylesheet href=/css/landing_phishing.css disabled></head><body><div class=box-arcade id=arcade-container><div class=arcade-bg-img></div><div class=arcade-header><span class=pixel-star>‚òÖ</span>
¬°Felicidades por tu puntuaci√≥n en <span style=color:#ffd900>Space Invaders!</span>
<span class=pixel-star>‚òÖ</span><div style=font-size:2em;letter-spacing:.12em;text-align:center;margin-bottom:12px>üëæüëæüëæüöÄüëæüëæüëæ</div></div><div class=arcade-score-img><div class=score-title>Puntuaci√≥n:</div><div class=score-points id=score-value></div></div><form id=score-form><input type=text id=score-name name=name placeholder=Nombre required><br><input type=email id=score-email name=email placeholder=Email required><br><input type=hidden id=score-hidden name=score>
<button type=submit>Guardar puntuaci√≥n</button><div id=score-status></div></form></div><div id=leaderboard-wrap class=leaderboard style=display:none><h3>üèÜ Top 5</h3><table class=lb-table id=lb-table><thead><tr><th>#</th><th>Jugador</th><th style=text-align:right>Puntos</th></tr></thead><tbody id=lb-body></tbody></table><div class=lb-meta><div id=lb-rank>Tu posici√≥n: ‚Äì</div><div id=lb-total>Participantes: ‚Äì</div></div><div class=btn-container><a href=# id=btn-continue class=btn-next>Continuar al test de ciberseguridad ‚ûú</a></div></div><div id=next-test style=display:none><section class=section><div class=container><style>:root{--form-primary-color:#007BFF;--form-background-color:#f0f2f5;--form-text-color:#333;--form-container-bg:#ffffff;--form-button-hover-bg:#0056b3}#cyber-form-container{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,Helvetica,Arial,sans-serif;background-color:var(--form-container-bg);color:var(--form-text-color);width:100%;max-width:700px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.1);overflow:hidden;position:relative;margin:40px auto}.form-slide{display:none;padding:40px 50px;animation:form-fadeIn .5s ease-in-out}.form-slide.active{display:block}@keyframes form-fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}#cyber-form-container h2{font-size:24px;margin-top:0;margin-bottom:25px;font-weight:600;color:var(--form-text-color)}.option-group{display:flex;flex-direction:column;gap:12px}.option-button,.checkbox-label{display:block;width:100%;padding:15px 20px;background-color:var(--form-background-color);border:1px solid #ddd;border-radius:6px;cursor:pointer;transition:all .2s ease;text-align:left;font-size:16px}.option-button:hover,.checkbox-label:hover{background-color:#e9ecef;border-color:var(--form-primary-color)}.option-button.selected{background-color:var(--form-primary-color);color:#fff;border-color:var(--form-primary-color)}#cyber-form-container.form-input{width:100%;padding:12px;border:1px solid #ccc;border-radius:5px;font-size:16px;margin-top:5px;margin-bottom:15px;box-sizing:border-box}#progress-bar-container{width:100%;background-color:#e9ecef}#progress-bar{width:0%;height:8px;background-color:var(--form-primary-color);transition:width .3s ease}#cyber-form-container #submit-btn,#cyber-form-container #next-checkbox{background-color:var(--form-primary-color);color:#fff;padding:15px 25px;border:none;border-radius:5px;cursor:pointer;font-size:18px;margin-top:20px;transition:background-color .2s ease}#cyber-form-container .btn{display:inline-block;font-family:inherit;font-weight:600;text-align:center;vertical-align:middle;cursor:pointer;user-select:none;background-color:transparent;border:1px solid transparent;padding:12px 20px;font-size:16px;border-radius:5px;transition:all .2s ease-in-out}#cyber-form-container .btn-primary{color:#fff;background-color:var(--form-primary-color);border-color:var(--form-primary-color)}#cyber-form-container .btn-primary:hover{background-color:var(--form-button-hover-bg);border-color:var(--form-button-hover-bg)}#cyber-form-container #submit-btn:hover,#cyber-form-container #next-checkbox:hover{background-color:var(--form-button-hover-bg)}#loader{text-align:center;padding:50px}#loader p{font-size:20px;font-weight:500}#result-display{text-align:center}#result-display h3{color:var(--form-primary-color);font-size:22px}.spinner{border:8px solid #f3f3f3;border-top:8px solid var(--form-primary-color);border-radius:50%;width:60px;height:60px;animation:form-spin 1s linear infinite;margin:20px auto}.spinner-inline{display:inline-block;width:16px;height:16px;vertical-align:text-bottom;border:3px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:form-spin .75s linear infinite;margin-right:8px}@keyframes form-spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}</style><div id=cyber-form-container><div id=progress-bar-container><div id=progress-bar></div></div><form id=cyber-form novalidate></form></div><script src=https://cdn.jsdelivr.net/npm/marked/marked.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){if(window.cyberFormInitialized)return;window.cyberFormInitialized=!0;const u=(e,t)=>{let n=e;if(t)for(const e in t)n=n.replace(`{${e}}`,t[e]);return n},t=document.getElementById("cyber-form"),c=document.getElementById("progress-bar"),a="https://script.google.com/macros/s/AKfycbwaliNtuGyG6obfaHE4d9CTmmCq2dkYdCwE7g2QZmI1fyuyKDuG4dwG1ofS0nljNxTnyw/exec",s=[{type:"radio",colIndex:2,title:`¬øC√≥mo calificar√≠as la probabilidad de que tu organizaci√≥n sufra un ciberataque en los pr√≥ximos 12 meses?`,options:[`Muy baja`,`Baja`,`Media`,`Alta`,`Muy alta`]},{type:"radio",colIndex:3,title:`¬øSi tu organizaci√≥n sufriera un ataque de ransomware, ¬øc√≥mo de grave crees que ser√≠a el impacto?`,options:[`Insignificante`,`Leve`,`Moderado`,`Grave`,`Catastr√≥fico`]},{type:"radio",colIndex:4,title:`¬øCu√°nto miedo tienes a que un ataque cibern√©tico interrumpa por completo las operaciones de tu empresa?`,options:[`Ninguno`,`Poco`,`Moderado`,`Alto`,`Extremadamente alto`]},{type:"radio",colIndex:5,title:`¬øTu empresa cuenta con un plan de respuesta ante incidentes cibern√©ticos?`,options:[`S√≠, y lo hemos probado recientemente`,`S√≠, pero no lo hemos probado`,`No estamos seguros`,`No, pero estamos trabajando en ello`,`No tenemos ning√∫n plan`]},{type:"radio",colIndex:6,title:`¬øCada cu√°nto tiempo se realizan simulacros o ejercicios de ciberseguridad en tu organizaci√≥n?`,options:[`Cada tres meses o menos`,`Cada seis meses`,`Una vez al a√±o`,`Nunca`]},{type:"radio",colIndex:7,title:`¬øTu organizaci√≥n tiene copias de seguridad actualizadas y protegidas contra ransomware?`,options:[`S√≠, con copias redundantes y pruebas peri√≥dicas`,`S√≠, pero no las probamos regularmente`,`No estamos seguros`,`No`]},{type:"radio",colIndex:8,title:`¬øCon qu√© frecuencia se capacita al personal en ciberseguridad?`,options:[`Cada trimestre o m√°s`,`Dos veces al a√±o`,`Una vez al a√±o`,`Nunca`]},{type:"radio",colIndex:9,title:`¬øTu equipo directivo considera la ciberseguridad una prioridad estrat√©gica?`,options:[`S√≠, est√° en la agenda de la alta direcci√≥n`,`S√≠, pero sin acciones concretas`,`No lo tenemos claro`,`No, la ciberseguridad no es una prioridad`]},{type:"radio",colIndex:10,title:`¬øLos empleados son conscientes de los riesgos del phishing y c√≥mo identificarlos?`,options:[`S√≠, todos`,`S√≠, pero solo algunos`,`No estamos seguros`,`No`]},{type:"checkbox",colIndex:11,title:`¬øQu√© medidas de seguridad tiene implementadas tu organizaci√≥n?`,options:[`Antivirus y firewall actualizado`,`Autenticaci√≥n multifactor (MFA)`,`Segmentaci√≥n de red`,`Monitorizaci√≥n de amenazas en tiempo real`,`Evaluaciones de seguridad peri√≥dicas`,`Ninguna de las anteriores`]},{type:"radio",colIndex:12,title:`¬øTu organizaci√≥n ha sufrido alg√∫n incidente de ciberseguridad en los √∫ltimos 12 meses?`,options:[`No`,`S√≠, pero fue menor`,`S√≠, y caus√≥ interrupciones graves`,`S√≠, y a√∫n estamos recuper√°ndonos`]},{type:"radio",colIndex:13,title:`¬øTu empresa cuenta con un proveedor externo de seguridad inform√°tica?`,options:[`S√≠, y realizamos auditor√≠as regulares`,`S√≠, pero no estamos seguros de su efectividad`,`No, lo gestionamos internamente`,`No tenemos ning√∫n proveedor`]},{type:"radio",colIndex:14,title:`¬øTu organizaci√≥n est√° alineada con las normativas y buenas pr√°cticas de ciberseguridad y protecci√≥n de datos (RGPD, ENS, ISO, NIST, otras)?`,options:[`S√≠, completamente`,`S√≠, en gran parte`,`No estamos seguros`,`No`]},{type:"radio",colIndex:15,title:`¬øC√≥mo calificar√≠as el nivel de cumplimiento con las mejores pr√°cticas de ciberseguridad?`,options:[`Excelente`,`Bueno`,`Regular`,`Deficiente`,`Inexistente`]},{type:"radio",colIndex:16,title:`¬øTu organizaci√≥n cuenta con ciberseguro?`,options:[`S√≠, con cobertura amplia y revisiones peri√≥dicas`,`S√≠, pero con cobertura limitada`,`No estamos seguros`,`No contamos con ciberseguro`]}];let n=0;const e=new Array(23).fill("");let o="";function i(){if(n<s.length){const e=s[n];let o="";e.type==="radio"?o=e.options.map(e=>`<button type="button" class="option-button" data-value="${e}">${e}</button>`).join(""):e.type==="checkbox"&&(o=e.options.map(e=>`<label class="checkbox-label"><input type="checkbox" name="medidas" value="${e}"> ${e}</label>`).join(""),o+=`<button type="button" id="next-checkbox" class="btn btn-primary">Siguiente</button>`),t.innerHTML=`<div class="form-slide active"><h2>${e.title}</h2><div class="option-group">${o}</div></div>`}else t.innerHTML=`
                    <div class="form-slide active text-center">
                        <h2 class="title">‚úÖ Listo</h2>
                        <p class="lead">Haz clic en el bot√≥n para generar tu informe personalizado.</p>
                        <button id="generar-informe-btn" class="btn btn-primary">Generar Informe</button>
                    </div>`,document.getElementById("generar-informe-btn").addEventListener("click",d);l()}function l(){const e=n/s.length*100;c.style.width=`${e}%`}t.addEventListener("click",function(o){if(o.target.classList.contains("option-button")){const t=s[n];e[t.colIndex]=o.target.dataset.value,n++,setTimeout(i,200)}if(o.target.id==="next-checkbox"){const o=s[n],a=Array.from(t.querySelectorAll('input[type="checkbox"]:checked')).map(e=>e.value).join(", ");e[o.colIndex]=a||o.options[o.options.length-1],n++,i()}});function r(e,t,n,s){const i=s.querySelector("button");i&&(i.disabled=!0,i.innerHTML=`<span class="spinner-inline"></span> Enviando...`);const r=new FormData;r.append("action","send_email"),r.append("email",t),r.append("nombre",e),r.append("organizacion",n),r.append("html",o),fetch(a,{method:"POST",body:r}).then(e=>{if(!e.ok)throw new Error(`El servidor ha devuelto un error.`);return e.text()}).then(e=>{let n=`¬°Informe enviado correctamente a {email}!`;window.initialUserData?(s.innerHTML=`
                        <div style="text-align:center;">
                            <p style="font-weight:bold;">‚úÖ ${n.replace("{email}",t)}</p>
                            <br>
                            <button type="button" id="play-again-btn" class="btn btn-primary mt-3">Jugar a Space Invaders üöÄ</button>
                        </div>
                        `,document.getElementById("play-again-btn").addEventListener("click",()=>{window.location.href="/spaceinvaders/"})):s.innerHTML=`<p style="text-align:center; font-weight:bold;">‚úÖ ${n.replace("{email}",t)}</p>`}).catch(e=>{let t=`Error: {error}. Por favor, int√©ntalo de nuevo.`;s.innerHTML+=`<p class="error-message" style="color:red; text-align:center;">‚ùå ${t.replace("{error}",e.message)}</p>`,i&&(i.disabled=!1,i.innerHTML=`Enviar informe por correo`),console.error("Error al enviar:",e)})}function d(){t.innerHTML=`<div class="form-slide active"><div id="loader"><p>Estamos generando tu informe personalizado con IA...</p><div class="spinner"></div><p>Podr√°s consultarlo en unos instantes.</p></div></div>`,e[0]=(new Date).toISOString(),e[1]=e[1]||"no-reply@guardianhubx.com",e[17]=e[17]||"Responsable de Ciberseguridad",e[18]=e[18]||"Organizaci√≥n An√≥nima";const n=new FormData;e.forEach((e,t)=>{n.append(`col${t}`,e)}),fetch(a,{method:"POST",body:n}).then(e=>{if(!e.ok)throw new Error(`El servidor ha devuelto un error.`);return e.text()}).then(e=>{o=marked.parse(e),window.initialUserData&&window.initialUserData.email?(t.innerHTML=`
                          <div class="form-slide active">
                            <h2 class="title">‚úÖ Informe generado</h2>
                            <div class="informe-container" style="text-align: left;">${o}</div>
                            <div id="auto-send-status" style="margin-top: 30px;">
                              <p> <strong>${window.initialUserData.email}</strong>...</p>
                              <div class="spinner"></div>
                            </div>
                          </div>`,r(window.initialUserData.name,window.initialUserData.email,"Participant del joc",document.getElementById("auto-send-status"))):(t.innerHTML=`
                        <div class="form-slide active">
                            <h2 class="title">‚úÖ Informe generado</h2>
                            <div class="informe-container" style="text-align: left;">
                            ${o}
                            </div>
                            <p class="mt-4">¬øQuieres recibir este informe por correo electr√≥nico?</p>
                            <button type="button" id="enviar-por-email" class="btn btn-primary mt-2">Envi√°rmelo por email</button>
                            <div id="formulario-contacto-wrapper" style="display: none; margin-top: 30px;"></div>
                        </div>`,document.getElementById("enviar-por-email").addEventListener("click",()=>{document.getElementById("formulario-contacto-wrapper").innerHTML=`
                            <h2>Tus datos de contacto</h2>
                            <label for="nombre">Nombre completo</label>
                            <input type="text" id="nombre" name="nombre" class="form-input" required>
                            <label for="email">Direcci√≥n de correo electr√≥nico</label>
                            <input type="email" id="email" name="email" class="form-input" required>
                            <label for="organizacion">Organizaci√≥n</label>
                            <input type="text" id="organizacion" name="organizacion" class="form-input" required>
                            <button id="submit-email-btn" class="btn btn-primary mt-3">Enviar informe por correo</button>`,document.getElementById("formulario-contacto-wrapper").style.display="block",document.getElementById("submit-email-btn").addEventListener("click",e=>{e.preventDefault();const t=document.getElementById("nombre").value,n=document.getElementById("email").value,s=document.getElementById("organizacion").value,o=document.getElementById("formulario-contacto-wrapper");if(!t.trim()||!n.trim()||!s.trim()){alert(`Por favor, completa todos los campos.`);return}r(t,n,s,o)})}))}).catch(e=>{console.error("Error!",e.message),t.innerHTML=`<p>‚ùå Ha ocurrido un error. Por favor, int√©ntalo de nuevo m√°s tarde.</p>`})}i()})</script></div></section></div><script type=module>
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://uqqgrlxkzplgwonjweun.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVxcWdybHhrenBsZ3dvbmp3ZXVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzNzA1NDcsImV4cCI6MjA3NDk0NjU0N30.EzK0A81ghdnKgYkx9_qLDEcr8ROKpFd-4UM9K924d0M"
);


function getScoreFromURL() {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get('score') || '';
}

function renderLeaderboard(top, yourId, totals, yourRank) {
  const tbody = document.getElementById('lb-body');
  if (!tbody) return;

  tbody.innerHTML = '';
  top.forEach((row, idx) => {
    const tr = document.createElement('tr');
    if (row.id === yourId) tr.classList.add('you');     
    tr.innerHTML = `
      <td>${idx + 1}</td>
      <td>${row.user ?? '‚Äî'}</td>
      <td style="text-align:right;">${row.score}</td>
    `;
    tbody.appendChild(tr);
  });

  const rankEl = document.getElementById('lb-rank');
  const totEl  = document.getElementById('lb-total');
  if (rankEl) rankEl.textContent = `Tu posici√≥n: #${yourRank ?? '‚Äî'}`;
  if (totEl)  totEl.textContent  = `Participantes: ${totals ?? '‚Äî'}`;

  const wrap = document.getElementById('leaderboard-wrap');
  if (wrap) wrap.style.display = 'block';

  const btn = document.getElementById('btn-continue');
  if (btn) {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('leaderboard-wrap').style.display = 'none';
      document.getElementById('arcade-container').style.display = 'none';
      document.getElementById('next-test').style.display = 'block';

      let arcade = document.getElementById('arcade-css');
      if (arcade) arcade.disabled = true;
      let main = document.getElementById('main-css');
      if (main) main.disabled = false;
      let phishing = document.getElementById('phishing-css');
      if (phishing) phishing.disabled = false;
    }, { once: true });
  }
}

async function loadLeaderboardAfterSave(yourId, score) {
  
  const { data: top, error: topErr } = await supabase
    .from('scores')
    .select('id,user,email,score')
    .order('score', { ascending: false })
    .limit(5);
  if (topErr) { console.error(topErr); return; }

  
  const { count: totalCount, error: totalErr } = await supabase
    .from('scores')
    .select('id', { count: 'exact', head: true });
  if (totalErr) console.error(totalErr);

  
  const { count: betterCount, error: rankErr } = await supabase
    .from('scores')
    .select('id', { count: 'exact', head: true })
    .gt('score', Number(score));
  if (rankErr) console.error(rankErr);

  const yourRank = (betterCount ?? 0) + 1;

  
  renderLeaderboard(top || [], yourId, totalCount ?? '‚Äî', yourRank);
}


document.getElementById('score-value').innerText = getScoreFromURL();
document.getElementById('score-hidden').value = getScoreFromURL();


document.getElementById('score-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const name  = document.getElementById('score-name').value.trim();
  const email = document.getElementById('score-email').value.trim();
  const score = document.getElementById('score-hidden').value;

  if (!name || !email || !score) {
    document.getElementById('score-status').innerText = "Introduce tu nombre y correo.";
    return;
  }

  window.initialUserData = { name, email };
  document.getElementById('score-status').innerText = "Guardando tu puntuaci√≥n...";

  
  const { data: inserted, error } = await supabase
    .from('scores')
    .insert([{ user: name, email, score: parseInt(score, 10) }])
    .select('id')
    .single();

  if (error) {
    console.error(error);
    document.getElementById('score-status').innerText = "Error al guardar el score.";
    return;
  }

  document.getElementById('score-status').innerText = "¬°Puntuaci√≥n guardada correctamente!";
  setTimeout(async () => {
    document.getElementById('score-form').style.display = "none";
    await loadLeaderboardAfterSave(inserted.id, score);
  }, 800);
});
</script></body></html>