{{/* layouts/shortcodes/recent-blog.html */}}

{{- $baseURL := "https://guardianhubx.com" -}}
{{- $jsonPath := cond (eq .Site.Language.Lang "ca") "/blog/ca/index.json" "/blog/index.json" -}}
{{- $finalURL := printf "%s%s" $baseURL $jsonPath -}}

{{- /* Si estem en PRODUCCIÓ ('hugo'), afegim la data per trencar la cau.
      Si estem en LOCAL ('hugo server'), no afegim res i s'utilitza la cau. */}}
{{- if hugo.IsProduction -}}
  {{ $finalURL = printf "%s?t=%d" $finalURL now.Unix }}
{{- end -}}

{{- /* Intentem descarregar el recurs remot */ -}}
{{ $res := try (resources.GetRemote $finalURL) }}

{{ if $res.Err }}
  {{ warnf "No s'ha pogut descarregar %s: %v" $finalURL $res.Err }}
{{ else }}
  {{ $remote := $res.Value }}
  {{ if $remote }}
    {{ $posts := $remote.Content | unmarshal }}
    {{ $dark := .Get "dark" | default "false" }}

    {{ $cardBg    := cond (eq $dark "true") "bg-secondary text-white" "bg-light" }}
    {{ $btnClass  := cond (eq $dark "true") "btn-outline-light" "btn-primary" }}
    {{ $textClass := cond (eq $dark "true") "text-light" "" }}

    {{ range first 3 $posts }}
      <div class="col-12 col-md-4">
        <div class="card h-100 shadow-sm border {{ cond (eq $dark "true") "border-light" "border-0" }} {{ $cardBg }}">
          <div class="card-body d-flex flex-column {{ $textClass }}">
            <h5 class="card-title">
              <a href="{{ .permalink }}" class="stretched-link text-decoration-none {{ $textClass }}">
                {{ .title }}
              </a>
            </h5>
            <p class="card-text mb-4 {{ $textClass }}">
              {{ .summary | plainify | truncate 120 }}
            </p>
            <a href="{{ .permalink }}" class="mt-auto btn {{ $btnClass }}">
              {{ i18n "readMore" | default "Leer más" }}
            </a>
          </div>
        </div>
      </div>
    {{ end }}

  {{ else }}
    {{ warnf "El recurs remot %q no està disponible" $finalURL }}
  {{ end }}
{{ end }}